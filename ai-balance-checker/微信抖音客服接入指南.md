# 微信 & 抖音客服接入指南

## 一、微信客服接入

---

### 1.1 认证类型对比

| 类型 | 适用场景 | 认证条件 | 费用 |
|------|---------|----------|------|
| **订阅号** | 个人博主/自媒体 | 身份证即可 | 免费 |
| **服务号** | 企业客服/商业 | 营业执照 | 免费 |
| **企业微信** | 公司内部/大规模客服 | 企业认证（¥300/年）| 收费 |

---

### 1.2 客服接口开通

#### 📱 订阅号/服务号（推荐个人/小团队）
**开通条件：**
- 已认证的订阅号或服务号
- 服务器域名备案（国内需要）

**开通流程：**
1. 登录微信公众平台
2. 进入「开发」→「基本配置」→「消息管理」
3. 开通「客服接口」功能
4. 配置服务器 URL

**费用：**
- 接口本身：免费
- 短信/邮件验证：按条收费（很少用到）

**限制：**
- 每天 48 小时主动推送额度
- 被动回复 5 秒内可无限

**技术要求：**
- 需要公网服务器或云服务器
- 支持 HTTPS 和 Token 验证
- 需要实时处理 WebSocket 或长轮询

#### 🏢 企业微信（推荐中大型企业）
**开通条件：**
- 已认证企业（需要营业执照）
- 至少 20 个员工
- 付费购买服务（按人数收费）

**开通流程：**
1. 企业微信管理后台
2. 进入「应用管理」→「自建应用」
3. 创建「内部应用」或「第三方应用」
4. 配置客服功能

**费用：**
- 企业认证：¥300/年
- 每个用户：¥300-400/年
- API 调用：按次数计费（便宜）

**优势：**
- 无需域名备案
- 功能强大（群发、素材库、会话记录）
- 可接 CRM、工单系统

**技术要求：**
- 企业微信 SDK 或 API
- 实时 WebSocket 连接
- 公网服务器（可选）

---

### 1.3 技术实现方案

#### 方案 A：服务器推送（推荐）
```
架构：
├─ 公众号/企业微信 ←─→ 消息推送 ←→ 用户

流程：
1. 用户发送消息 → 微信服务器接收
2. 微信服务器回调到你的服务器
3. 你的服务器调用 LLM API 生成回复
4. 你的服务器通过接口推送回复给用户

技术栈：
- 后端：Python + FastAPI / Node.js + Express
- WebSocket：用于接收实时消息
- LLM：千问 API / 通义千问 API / OpenAI
```

**优点：**
- ✅ 数据完全掌控（本地数据库）
- ✅ 可扩展性强
- ✅ 成本可控

**缺点：**
- ⚠️ 需要维护服务器
- ⚠️ 需要处理并发和高可用

---

#### 方案 B：无服务器方案（SAAS）
```
架构：
├─ 公众号/企业微信 ←─→ 第三方平台 ←→ LLM API ←→ 用户

第三方平台：
- 容联云
- 阿里云
- Dify（开源方案）
```

**优点：**
- ✅ 免运维
- ✅ 快速上线
- ✅ 高可用（第三方保证）

**缺点：**
- ❌ 数据存储在第三方
- ❌ 成本较高（平台抽成）
- ❌ 定制功能受限

---

### 1.4 关键技术注意事项

#### Token 验证
```python
# 微信服务器 URL 会带上签名参数
signature = sha1(timestamp + nonce + token)
# 需要验证签名确保请求来自微信
```

#### 消息加密
```
部分敏感消息需要加密
用户发送 → 解密 → 处理 → 加密回复
```

#### 消息去重
```python
# 微信会重复推送消息
需要根据 msgid 去重，避免重复处理
```

#### 主动推送限制
```
订阅号：
- 用户订阅：每天 1 条
- 模板消息：每用户 100 万/月

服务号：
- 无主动推送限制
- 全部用户可触达

企业微信：
- 无限制（但受费用约束）
```

---

## 二、抖音客服接入

---

### 2.1 账号类型对比

| 类型 | 适用场景 | 认证条件 | 费用 |
|------|---------|----------|------|
| **个人号** | 个人博主 | 手机号+身份证 | 免费 |
| **企业号** | 公司业务 | 营业执照+对公账户 | 免费 |
| **蓝 V 认证** | 更高信任度 | 企业资质+费用 | 收费 |

**注意：** 个人号无法开通客服接口，必须用企业号或蓝 V 认证

---

### 2.2 客服接口开通

#### 🎵 企业号（推荐）
**开通条件：**
- 已认证的抖音企业号
- 需要绑定企业主体

**开通流程：**
1. 登录抖音开放平台：https://developer.open-douyin.com
2. 进入「企业服务」→「客户联系」
3. 开通「智能客服」能力
4. 配置回调 URL

**费用：**
- 开通：免费
- API 调用：按次计费（具体见官网）
- 超出套餐：可购买（¥99-999/月）

**限制：**
- 每日 API 调用次数有限制
- 内容审核严格（禁止违规、敏感词）

**优势：**
- ✅ 支持 AI 客服回复
- ✅ 支持文本、图片、视频回复
- ✅ 支持快捷短语设置

---

### 2.3 蓝V 认证（更高信任）

**开通条件：**
- 企业主体认证
- 抖音企业号
- 缴纳认证费用（¥3000）

**优势：**
- ✅ 更高信任度
- ✅ 更多高级功能
- ✅ 减少封号风险

**劣势：**
- ❌ 认证费用高
- ❌ 审核时间更长

---

### 2.4 技术实现方案

#### 方案 A：机器人 API（推荐）
```
架构：
├─ 抖音用户 ←─→ 发送消息 ←→ 抖音服务器 ←→ Webhook ←→ 你的服务器 ←→ 调用 LLM API ←→ 回复 ←→ 你的服务器 ←→ 调用机器人 API ←→ 抖音服务器 ←→ 用户

流程：
1. 用户发送消息
2. 抖音服务器通过 Webhook 推送到你的服务器
3. 你的服务器调用 LLM API 生成回复
4. 你的服务器调用机器人 API 发送回复
```

**关键 API：**
- 发送消息：`bot.messages.send`
- 上传素材：`bot.images.create`
- 创建快捷短语：`bot.quick_reply.create`

**技术栈：**
- 后端：Python + FastAPI
- LLM：千问 API / 通义 API
- 抖音 SDK：pip install douyin-open-api

---

#### 方案 B：无服务器方案
```
使用第三方客服系统（如容联云）
├─ 抖音 ←─→ 第三方平台 ←→ LLM API
```

**优点：**
- ✅ 快速上线
- ✅ 无需开发
- ✅ 稳定可靠

**缺点：**
- ❌ 成本高
- ❌ 定制受限
- ❌ 数据在第三方

---

### 2.5 关键技术注意事项

#### 内容审核
```
所有回复消息都会经过抖音审核
违规内容类型：
- 敏感词（政治、色情等）
- 虚假广告
- 欺诈信息
- 不合规的医疗建议

后果：
- 消息被拦截
- 账号被封禁
```

#### 消息发送限制
```
企业号限制：
- 每分钟发送数量：视等级而定
- 每天总发送数量：有上限
- 对同一用户：有频率限制

解决方案：
- 使用智能客服优先处理（AI 优先）
- 缓存高频问题答案
- 排队系统处理低优先级问题
```

#### 机器人权限
```
需要开通的权限：
- 发送消息权限
- 上传图片/视频权限
- 访问用户基本信息权限
- 创建快捷短语权限

注意：
- 机器人不能主动发起对话
- 只能在用户发送消息后 24 小时内回复
```

---

## 三、对接技术选型建议

### 3.1 推荐架构（基于 Dify）
```
前端：Next.js / Vue 3（管理后台）
后端：Dify（开源部署）+ 定制 API
LLM：千问 API（国内便宜、中文友好）
数据库：PostgreSQL + Redis
存储：阿里云 OSS / MinIO
```

---

### 3.2 成本优化策略
```
LLM API：
- 使用千问 API（¥0.008/1k tokens）
- 使用缓存减少重复调用
- 使用更便宜的模型处理简单问题

服务器：
- 使用轻量级云服务器（阿里云 2C4G，¥300/月）
- 按需扩容（负载均衡 + 阿里云）

存储：
- 对话记录用数据库
- 文件素材用 OSS
```

---

## 四、接入流程时间线

### 微信接入
```
第 1 周：申请账号 + 企业认证（如需要）
第 2 周：域名备案 + 部署服务器
第 3 周：开通客服接口 + 开发测试
第 4 周：正式上线 + 优化
```

### 抖音接入
```
第 1 周：申请企业号 + 开发者认证
第 2 周：开通客服接口权限
第 3 周：对接机器人 API + 测试
第 4 周：内容审核测试 + 正式上线
```

---

## 五、风险提示

### 平台风险
```
微信：
- 诱导用户分享 → 封号
- 恶意营销 → 限制功能
- 违规内容 → 永久封禁

抖音：
- 内容审核严格 → 消息拦截
- 频率限制 → 触发风控
- 批量操作 → 机器检测封号
```

### 合规建议
```
1. 提供明显的客服标识
2. 不发送营销骚扰信息
3. 遵守平台内容规范
4. 提供人工客服入口
5. 建立投诉反馈机制
6. 定期更新知识库内容
```

---

## 六、快速检查清单

接入前必须确认：
- [ ] 已申请企业微信账号（或认证公众号）
- [ ] 已申请抖音企业号（个人号无法开通客服）
- [ ] 有公网 IP 服务器或云服务器
- [ ] 服务器已配置 HTTPS（必须）
- [ ] 已购买并配置域名（如需备案）
- [ ] 已准备好 LLM API 密钥（千问/通义/OpenAI）

技术栈确认：
- [ ] 后端语言（推荐 Python + FastAPI）
- [ ] WebSocket 库选型（Socket.IO / websockets）
- [ ] 数据库选型（PostgreSQL 推荐）
- [ ] 对接 SDK 版本
- [ ] 测试环境已搭建

---

## 七、推荐学习资源

- 微信开放平台：https://developers.weixin.qq.com/doc
- 抖音开放平台：https://developer.open-douyin.com
- Dify 官方文档：https://docs.dify.ai
- 千问 API 文档：https://help.aliyun.com/zh/dashun/
- 容联云客服文档：https://www.volcengine.com/docs

---

更新时间：2026-02-05
